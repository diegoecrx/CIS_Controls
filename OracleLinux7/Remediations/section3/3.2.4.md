# 3.2.4 Ensure sctp kernel module is not available

## Compliance Requirement

**Command to Check:**
```bash
multiple line script
```

**Expected Output:**
```
(?i)^[\s]*\**[\s]*pass:?[\s]*\**$
```

## Solution

Run the following script to disable the sctp module:

-IF- the module is available in the running kernel:

 - Create a file with install sctp /bin/false in the /etc/modprobe.d/ directory
 - Create a file with blacklist sctp in the /etc/modprobe.d/ directory
 - Unload sctp from the kernel

-IF- available in ANY installed kernel:

 - Create a file with blacklist sctp in the /etc/modprobe.d/ directory

-IF- the kernel module is not available on the system or pre-compiled into the kernel:

 - No remediation is necessary

#!/usr/bin/env bash

{
   l_mname="sctp" # set module name
   l_mtype="net" # set module type
   l_mpath="/lib/modules/**/kernel/$l_mtype"
   l_mpname="$(tr '-' '_' > /etc/modprobe.d/"$l_mpname".conf
      fi
   }
   module_loaded_fix()
   {
      # If the module is currently loaded, unload the module
      if lsmod | grep "$l_mname" > /dev/null 2>&1; then
         echo -e "
 - unloading module \"$l_mname\""
         modprobe -r "$l_mname"
      fi
   }
   module_deny_fix()
   {
      # If the module isn't deny listed, denylist the module
      if ! modprobe --showconfig | grep -Pq -- "^h*blacklisth+$l_mpnameb"; then
         echo -e "
 - deny listing \"$l_mname\""
         echo -e "blacklist $l_mname" >> /etc/modprobe.d/"$l_mpname".conf
      fi
   }
   # Check if the module exists on the system
   for l_mdir in $l_mpath; do
      if [ -d "$l_mdir/$l_mndir" ] && [ -n "$(ls -A $l_mdir/$l_mndir)" ]; then
         echo -e "
 - module: \"$l_mname\" exists in \"$l_mdir\"
 - checking if disabled..."
         module_deny_fix
         if [ "$l_mdir" = "/lib/modules/$(uname -r)/kernel/$l_mtype" ]; then
            module_loadable_fix
            module_loaded_fix
         fi
      else
         echo -e "
 - module: \"$l_mname\" doesn't exist in \"$l_mdir\"
"
      fi
   done
   echo -e "
 - remediation of module: \"$l_mname\" complete
"
}
